<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <input type="file" id="imgFile" name="imgFile" value="选择图片" />
</body>

</html>
<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
<script>
    $(function () {

        $("#imgFile").change(function () {

            var file = this.files[0];

            var reader = new FileReader();

            reader.readAsDataURL(file);//调用自带方法进行转换  
            reader.onload = function (e) {
                // $("#img_upload_show").attr("src", this.result);//将转换后的编码存入src完成预览  
                // $("#img_upload_base").val(this.result);//将转换后的编码保存到input供后台使用  
                // alert(this.result);
                var img = this.result;
                // var imgType=img.Substring(0,i)
                var imgNum = img.split(";base64,");
                var imgBase = imgNum[1];
                // console.log(imgBase)
                // console.log(this.result)

                var formData = new FormData();
                formData.append("base64Image", this.result);
                formData.append("language", "chs");
                formData.append("apikey", "82ad99e83388957");//2...@qq.com


                $.ajax({
                    url: 'https://api.ocr.space/parse/image',
                    data: formData,
                    dataType: 'json',
                    cache: false,
                    contentType: false,
                    processData: false,
                    type: 'POST',
                    timeout: 25000,
                    success: function (ocrParsedResult) {
                        //得到识别结果

                        // console.log(ocrParsedResult)

                        //Get the parsed results, exit code and error message and details
                        var parsedResults = ocrParsedResult["ParsedResults"];
                        var ocrExitCode = ocrParsedResult["OCRExitCode"];
                        var isErroredOnProcessing = ocrParsedResult["IsErroredOnProcessing"];
                        var errorMessage = ocrParsedResult["ErrorMessage"];
                        var errorDetails = ocrParsedResult["ErrorDetails"];
                        var processingTimeInMilliseconds = ocrParsedResult["ProcessingTimeInMilliseconds"];
                     
                        if (parsedResults != null) {
           
                            $.each(parsedResults, function (index, value) {
                                var exitCode = value["FileParseExitCode"];
                                var parsedText = value["ParsedText"];
                                var errorMessage = value["ParsedTextFileName"];
                                var errorDetails = value["ErrorDetails"];

                                var textOverlay = value["TextOverlay"];
                                var pageText = '';
                                switch (+exitCode) {
                                    case 1:
                                        pageText = parsedText;
                                        break;
                                    case 0:
                                    case -10:
                                    case -20:
                                    case -30:
                                    case -99:
                                    default:
                                        pageText += "Error: " + errorMessage;
                                        break;
                                }

                                if (pageText) {
                                    console.log(pageText)
                                } else {
                                    alert('未识别出结果,请重新截图');
                                    num--;
                                }
                            });
                        }
                        else {
                            alert('未识别成功')
                        }
                    },
                    complete: function (XMLHttpRequest, textStatus) {
                        //console.log('Quzi ', 'complete', XMLHttpRequest);
                        //console.log('Quzi ', 'complete', textStatus);
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        //未得到识别结果
                        console.log('Quzi ', XMLHttpRequest);
                        console.log('Quzi ', textStatus);
                        console.log('Quzi ', errorThrown);

                        switch (textStatus) {
                            case 'timeout':
                                alert('识别请求超时,请检测网络');
                                break;
                            case 'error':
                                alert('当前网络异常,请检测网络连接情况');
                                break;
                            default:
                                break;
                        }

                    }
                });


















            }





        })



    })
</script>